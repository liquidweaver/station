<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script defer>
		function loadAssets(sources, callback) {
			var assetDir = 'sprites/';
			var imageExtension = '.dmi';
			var metaExtension = '.meta';
			var images = {};
			var loadedAssets = 0;
			var numAssets = Object.keys(sources).length * 2;

			loaded_callback = function() {
				if(++loadedAssets >= numAssets) {
					callback(images);
				}
			};

			for(var src in sources) {
				images[src] = new Image();
				images[src].onload = loaded_callback;
				images[src].src = assetDir + sources[src] + imageExtension;
				$.get(  assetDir + sources[src] + metaExtension, function( data ) {
					images[src].meta = parse_meta( data );
					loaded_callback();
				});
			}
		}

		function parse_meta( dmi_meta ) {
			console.log( dmi_meta );
			return dmi_meta;
		}

		var sources = {
			floors: 'floors',
		};

		loadAssets(sources, function(images) {
			console.log("done");
		});

</script>
</head>
<body>
</body>
</html>
